## efs.tf
resource "aws_efs_file_system" "wp_efs" {
  creation_token = "wp_efs"
  throughput_mode = "bursting"
  
   tags = {
     Name = "wp_efs"
   }
 }

resource "aws_efs_mount_target" "wp_efs_mount" {
   depends_on = [aws_efs_file_system.wp_efs]
   file_system_id  = aws_efs_file_system.wp_efs.id
   subnet_id = aws_instance.my-rds-wp.subnet_id
   security_groups = [aws_security_group.wp_efs_sg.id]
 }


# Creating Mount Point for EFS
resource "null_resource" "EC2-mount" {
depends_on = [aws_efs_mount_target.wp_efs_mount]
connection {
    type      = "ssh"
    user      = "ec2-user"
    #key_name  = "${aws_key_pair.ec2-key.id}"
    private_key = tls_private_key.mykey.private_key_pem
    host      = aws_instance.my-rds-wp.public_ip
 }
}

/*
provisioner "remote-exec" {
    inline = [
      #Mounting Efs 
      "sudo mount -t nfs4 ${aws_efs_mount_target.wp_efs_mount.ip_address}:/  /var/www/html"
  ]
 }
}
*/
